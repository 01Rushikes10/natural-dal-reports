name: ğŸ¥˜ Natural Dal Daily Report

on:
  schedule:
    # Runs at 6:00 PM IST daily (12:30 PM UTC)
    # Format: minute hour day month day-of-week
    - cron: '30 12 * * *'
  
  # Allows manual trigger from GitHub UI
  workflow_dispatch:
  
  # Trigger when code is pushed (for testing)
  push:
    branches: [ main ]

jobs:
  send-daily-report:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“… Check time
      run: |
        echo "ğŸ•’ Current UTC time: $(date)"
        echo "ğŸ‡®ğŸ‡³ IST time: $(date -d '+5:30' '+%H:%M')"
        echo "ğŸ“… Today's date: $(date '+%d/%m/%Y')"
    
    - name: ğŸš€ Trigger Daily Report
      run: |
        # Your report URL
        REPORT_URL="https://naturaldal1.kesug.com/wp-content/plugins/natural-dal-reports/send_daily_report.php?force=yes&source=github"
        
        echo "ğŸ“¡ Calling: $REPORT_URL"
        
        # Send request with 30 second timeout
        curl -s \
          --max-time 30 \
          --retry 2 \
          --retry-delay 5 \
          "$REPORT_URL"
        
        echo "âœ… Report triggered successfully!"
        
        # Also log to GitHub Actions
        echo "::notice ::Daily report sent at $(date '+%H:%M %d/%m/%Y')"
    
    - name: ğŸ“ Log Completion
      if: always()
      run: |
        echo "ğŸ‰ Workflow completed at $(date)"
        echo "ğŸ“§ Check your email at bbbrn01@gmail.com"
